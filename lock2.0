-- Criminality Name ESP
-- Optimized for performance and compatibility with Solara Executor

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ESP Configuration
local ESP = {
    Enabled = true,
    TeamCheck = false, -- Set to true if you want to exclude teammates
    BoxColor = Color3.fromRGB(255, 0, 0),
    TextColor = Color3.fromRGB(255, 255, 255),
    TextSize = 14,
    TextFont = Enum.Font.SourceSansBold,
    MaxDistance = 1000, -- Maximum distance to render ESP
}

-- Create ESP objects
local function CreateESP(player)
    local esp = Drawing.new("Text")
    esp.Visible = false
    esp.Center = true
    esp.Outline = true
    esp.Font = ESP.TextFont
    esp.Size = ESP.TextSize
    esp.Color = ESP.TextColor
    esp.OutlineColor = ESP.BoxColor
    return esp
end

-- Update ESP
local function UpdateESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
                continue
            end

            local humanoidRootPart = player.Character.HumanoidRootPart
            local vector, onScreen = Camera:WorldToViewportPoint(humanoidRootPart.Position)
            local distance = (Camera.CFrame.Position - humanoidRootPart.Position).Magnitude

            if not player.espObject then
                player.espObject = CreateESP(player)
            end

            if onScreen and distance <= ESP.MaxDistance and ESP.Enabled then
                player.espObject.Position = Vector2.new(vector.X, vector.Y)
                player.espObject.Text = string.format("%s [%d]", player.Name, math.floor(distance))
                player.espObject.Visible = true
            else
                player.espObject.Visible = false
            end
        end
    end
end

-- Clean up ESP objects when players leave
Players.PlayerRemoving:Connect(function(player)
    if player.espObject then
        player.espObject:Remove()
        player.espObject = nil
    end
end)

-- Main loop
RunService:BindToRenderStep("ESP", Enum.RenderPriority.Camera.Value, UpdateESP)

-- Toggle ESP function
local function ToggleESP()
    ESP.Enabled = not ESP.Enabled
    if not ESP.Enabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player.espObject then
                player.espObject.Visible = false
            end
        end
    end
end

-- Keybind to toggle ESP (Press 'E' to toggle)
game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.E then
        ToggleESP()
    end
end)

print("Criminality Name ESP loaded. Press 'E' to toggle.")
